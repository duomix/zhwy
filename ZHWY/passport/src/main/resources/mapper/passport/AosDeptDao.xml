<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.aisino.passport.sys.dao.IAosDeptDao">
	
	<!-- 查询组织机构树 -->
	<select id="querySystemDept" parameterType="XHashMap" resultType="XHashMap" >
		select 
				<if test="userid != null and userid !=''"> 
			    ud.deptid as checked, 
			    </if>
			    d.deptid as id, d.deptname as name, d.*
			from
			    aos_dept d
			    <if test="userid != null and userid !=''"> 
			        left join
			    (select 
			        d.deptid
			    from
			        aos_dept d
			    inner join aos_dutydatares dd on d.deptid = dd.deptid
			    inner join aos_user_duty ud on dd.dutyid = ud.dutyid
			    where
			        ud.userid = #{userid}) ud on d.deptid = ud.deptid
			   </if>    
			where  1=1
				<if test="pid != null and pid !=''"> 
			    	and  d.pid = #{pid}
			    </if>
			    <if test="deptname != null and deptname !=''"> 
			    	and d.deptname like '%${deptname}%'
			    </if>
	</select>
	
	
	
	
	<select id="findList" parameterType="AosDept" resultType="AosDept" >
		select 
				t.deptid, t.pid, t.deptname, t.deptcode, t.tier, t.leaf_node, t.createdate, t.createby, t.available,
				(select  d.deptname  from aos_dept d where t.pid = d.deptid) as pname
			from aos_dept t 
			
			where 1 = 1  
			<if test="deptid != null and deptid !=''"> and 
				t.deptid = #{deptid}
			</if>
			<if test="pid != null and pid !=''"> and 
				t.pid = #{pid}
			</if>
			<if test="deptname != null and deptname !=''"> and 
				t.deptname like  concat(concat('%',#{deptname}),'%')
			</if>
			<if test="deptcode != null and deptcode !=''"> and 
				t.deptcode = #{deptcode}
			</if>
			<if test="tier != null and tier !=''"> and 
				t.tier = ${tier}
			</if>
			<if test="leaf_node != null and leaf_node !=''"> and 
				t.leaf_node = ${leaf_node}
			</if>
			<if test="createdate != null and createdate !=''"> and 
				t.createdate = #{createdate}
			</if>
			<if test="createby != null and createby !=''"> and 
				t.createby = #{createby}
			</if>
			<if test="available != null and available !=''"> and 
				t.available = ${available}
			</if>
			order by t.createdate desc
	</select>

	<select id="get" parameterType="AosDept" resultType="AosDept" >
		select 
				t.deptid, t.pid, t.deptname, t.deptcode, t.tier, t.leaf_node, t.createdate, t.createby, t.available,
				(select  d.deptname  from aos_dept d where t.pid = d.deptid) as pname
			from aos_dept t 
			
			where 1 = 1  
			<if test="deptid != null and deptid !=''"> and 
				t.deptid = #{deptid}
			</if>
			<if test="pid != null and pid !=''"> and 
				t.pid = #{pid}
			</if>
			<if test="deptname != null and deptname !=''"> and 
				t.deptname = #{deptname}
			</if>
			<if test="deptcode != null and deptcode !=''"> and 
				t.deptcode = #{deptcode}
			</if>
			<if test="tier != null and tier !=''"> and 
				t.tier = ${tier}
			</if>
			<if test="leaf_node != null and leaf_node !=''"> and 
				t.leaf_node = ${leaf_node}
			</if>
			<if test="createdate != null and createdate !=''"> and 
				t.createdate = #{createdate}
			</if>
			<if test="createby != null and createby !=''"> and 
				t.createby = #{createby}
			</if>
			<if test="available != null and available !=''"> and 
				t.available = ${available}
			</if>
	</select>

	<insert id="insert" parameterType="AosDept">
		insert into aos_dept
			(deptid 
		<if test="pid != null and pid !=''"> , pid</if>
		<if test="deptname != null and deptname !=''"> , deptname</if>
		<if test="deptcode != null and deptcode !=''"> , deptcode</if>
		<if test="tier != null and tier !=''"> , tier</if>
		<if test="leaf_node != null and leaf_node !=''"> , leaf_node</if>
		<if test="createdate != null and createdate !=''"> , createdate</if>
		<if test="createby != null and createby !=''"> , createby</if>
		<if test="available != null and available !=''"> , available</if>
		)
		values 			(#{deptid} 
		<if test="pid != null and pid !=''"> , #{pid}</if>
		<if test="deptname != null and deptname !=''"> , #{deptname}</if>
		<if test="deptcode != null and deptcode !=''"> , #{deptcode}</if>
		<if test="tier != null and tier !=''"> , ${tier}</if>
		<if test="leaf_node != null and leaf_node !=''"> , ${leaf_node}</if>
		<if test="createdate != null and createdate !=''"> , #{createdate}</if>
		<if test="createby != null and createby !=''"> , #{createby}</if>
		<if test="available != null and available !=''"> , ${available}</if>
		)

	</insert>

	<update id="update" parameterType="AosDept">
		update aos_dept 
			set deptid   = #{deptid}

				<if test="pid != null and pid !=''"> , pid = #{pid}</if>
				<if test="deptname != null and deptname !=''"> , deptname = #{deptname}</if>
				<if test="deptcode != null and deptcode !=''"> , deptcode = #{deptcode}</if>
				<if test="tier != null and tier !=''"> , tier = ${tier}</if>
				<if test="leaf_node != null and leaf_node !=''"> , leaf_node = ${leaf_node}</if>
				<if test="createdate != null and createdate !=''"> , createdate = #{createdate}</if>
				<if test="createby != null and createby !=''"> , createby = #{createby}</if>
				<if test="available != null and available !=''"> , available = ${available}</if>
		where deptid = #{deptid}
	</update>

	<delete id="delete" parameterType="AosDept">
		delete from aos_dept  where deptid = #{deptid}
	</delete>

</mapper>
